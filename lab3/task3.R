# Установка параметров
m <- 20          # число строк решетки
n <- 20          # число столбцов решетки
beta1 <- 0.5      # параметр для горизонтальных связей
beta2 <- 0.5       # параметр для вертикальных связей
iterations <- 10    # число итераций

# Инициализация начальной конфигурации случайным образом
set.seed(42)  # для воспроизводимости
x <- matrix(sample(c(-1, 1), m * n, replace = TRUE), nrow = m, ncol = n)

# Функция для вычисления локального поля b_k
compute_bk <- function(x, i, j, beta1, beta2, m, n) {
  bk <- 0
  # Горизонтальные соседи
  if (j > 1) bk <- bk + beta1 * x[i, j - 1]  # левый сосед
  if (j < n) bk <- bk + beta1 * x[i, j + 1]  # правый сосед
  # Вертикальные соседи
  if (i > 1) bk <- bk + beta2 * x[i - 1, j]  # верхний сосед
  if (i < m) bk <- bk + beta2 * x[i + 1, j]  # нижний сосед
  return(bk)
}

# Схема Гиббса
for (iter in 1:iterations) {
  for (i in 1:m) {
    for (j in 1:n) {
      # Вычисление локального поля
      bk <- compute_bk(x, i, j, beta1, beta2, m, n)
      # Вероятность P(x_k = +1 | x_{-k})
      p <- 1 / (1 + exp(-2 * bk))
      # Генерация случайного числа
      u <- runif(1)
      # Обновление спина
      x[i, j] <- ifelse(u < p, 1, -1)
    }
  }
}

# Вывод итоговой конфигурации
print("Итоговая конфигурация решетки:")
print(x)

dev.new(width=10, height=8) # Указание ширины и высоты в дюймах
# Визуализация (опционально)
image(x, col = c("black", "white"), 
      main = paste("Конфигурация модели Изинга (iter =", iterations, 
                   ", beta1 =", beta1, ", beta2 =", beta2, ")"))
