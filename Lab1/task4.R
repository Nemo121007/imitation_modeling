set.seed(42)  # Для воспроизводимости

# Заданные параметры
lambda <- 2  # Параметр распределения Пуассона
D <- 10       # Толщина слоя в метрах
t_max <- 3e-8  # Пороговое время совпадения в секундах
C <- 3e8      # Скорость света в м/с

# Количество итераций моделирования
num_trials <- 10000
success_count <- 0  # Количество успешных срабатываний схемы

for (i in 1:num_trials) {
  N <- rpois(1, lambda) + 1  # Генерируем число фотонов
  
  if (N < 2) next  # Нужны хотя бы два фотона
  
  # Генерируем случайные координаты по толщине D
  x <- runif(N, 0, D)
  
  # Генерируем углы распространения фотонов в диапазоне [0, 2π]
  theta <- runif(N, 0, 2 * pi)
  
  # Определяем, куда летит фотон
  path_length <- ifelse((theta >= pi/2) & (theta < 3*pi/2), x, (D - x))
  
  # Вычисляем времена попадания в детекторы
  t_detect <- (path_length / C) / abs(cos(theta))
  
  # Проверяем минимальный временной интервал между попаданиями
  t_sorted <- sort(t_detect)
  if (any(diff(t_sorted) < t_max)) {
    success_count <- success_count + 1
  }
}

# Оценка вероятности срабатывания схемы
prob_success <- success_count / num_trials
cat("Вероятность срабатывания схемы:", prob_success, "\n")
