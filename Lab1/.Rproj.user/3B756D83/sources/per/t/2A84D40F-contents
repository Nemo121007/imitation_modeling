set.seed(42)  # Для воспроизводимости

# Заданные параметры
lambda <- 2  # Параметр распределения Пуассона
D <- 1       # Толщина слоя в метрах
t_max <- 3e-8  # Пороговое время совпадения в секундах
C <- 3e8      # Скорость света в м/с

# Количество итераций моделирования
num_trials <- 10000
success_count <- 0  # Количество успешных срабатываний схемы

for (i in 1:num_trials) {
  M <- rpois(1, lambda) + 1  # Генерируем число фотонов
  
  if (M < 2) next  # Нужны хотя бы два фотона
  
  # Генерируем случайные координаты по толщине D
  x <- runif(M, 0, D)
  
  # Генерируем углы распространения фотонов (изотропно от -pi/2 до pi/2)
  theta <- runif(M, -pi/2, pi/2)
  
  # Вычисляем времена попадания в детекторы
  t_left <- (x / C) / cos(theta)  # Для фотонов, уходящих влево
  t_right <- ((D - x) / C) / cos(theta)  # Для фотонов, уходящих вправо
  
  # Объединяем времена, учитывая только действительные (положительные)
  t_detect <- c(t_left[t_left > 0], t_right[t_right > 0])
  
  # Проверяем минимальный временной интервал между попаданиями
  t_sorted <- sort(t_detect)
  if (any(diff(t_sorted) < t_max)) {
    success_count <- success_count + 1
  }
}

# Оценка вероятности срабатывания схемы
prob_success <- success_count / num_trials
cat("Вероятность срабатывания схемы:", prob_success, "\n")